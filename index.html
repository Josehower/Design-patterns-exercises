<!DOCTYPE html>
<html>

<head>
</head>

<body>

  <h1>Maze Creator</h1>


  <script>
    class MapSite {
      constructor() {
        if (this.constructor === MapSite) {
          throw 'this is an Abstrct Class';
        }
      }

      enter() {
        throw 'this method need to be implemented on each subClass';
      }
    }

    class Room extends MapSite {
      constructor() {
        super();
        this.name = `room${Room.prototype.conteo}`;
        this.roomNumber = Room.prototype.conteo;
        this.structure = {};
        console.log(`creating room number ${this.roomNumber}`);
        Room.prototype.conteo++;
      }

      enter() {
        console.log(`your are now on room number ${this.roomNumber}`);
      }

      setSide(direction, MapSiteComponent) {
        if (
          !(
            direction === 'N' ||
            direction === 'S' ||
            direction === 'E' ||
            direction === 'W'
          )
        ) {
          throw 'you have to set a real direction N, S, E, or W';
        } else {
          this.structure[direction] = MapSiteComponent;
        }
      }

      getSide(direction) {
        if (
          !(
            direction === 'N' ||
            direction === 'S' ||
            direction === 'E' ||
            direction === 'W'
          )
        ) {
          throw 'you have to set a real direction N, S, E, or W';
        } else if (this[direction]) {
          console.log(this[direction].name);
        } else {
          console.log('nothing There');
        }
      }
    }

    Room.prototype.conteo = 1;

    class EnchantedRoom extends Room {
      constructor() {
        super();
        this.name = `enchanted room${this.roomNumber}`;
        console.log(`creating EnchantedRoom number ${this.roomNumber}`);
      }
    }

    class Wall extends MapSite {
      constructor() {
        super();
        this.name = `Wall${Wall.prototype.conteo}`;
        this.wallNumber = Wall.prototype.conteo;
        console.log(`creating wall number ${this.wallNumber}`);
        Wall.prototype.conteo++;
      }
    }
    Wall.prototype.conteo = 1;

    class Door extends MapSite {
      constructor(roomA, roomB) {
        super();
        if (!(roomA && roomB)) {
          throw 'need two rooms';
        }

        this.name = `Door${Door.prototype.conteo}`;
        this.doorNumber = Door.prototype.conteo;
        this.between = [roomA.name, roomB.name];
        console.log(
          `creating door # ${this.doorNumber} between ${this.between[0]} and ${this.between[1]} `
        );
        Door.prototype.conteo++;
      }
    }
    Door.prototype.conteo = 1;

    class DoorNeedingSpell extends Door {
      constructor(roomA, roomB) {
        super(roomA, roomB);
        this.name = `enchanted door${this.doorNumber}`;
        console.log(`creating EnchantedDoor number ${this.doorNumber}`);
        this.protectedBySpell = true;
      }

      unlock(spell) {
        this.protectedBySpell = spell !== 'kadabra';
        console.log('you tried to unlock the door...');
      }
    }

    class Maze {
      constructor() {
        console.log(`creating a new Maze`);
        this.rooms = [];
      }

      addRoom(room) {
        this.rooms.push(room);
      }

      /* TODO: create search RoomNo. method */
    }

    class MazeFactory {
      makeMaze() {
        return new Maze();
      }

      makeWall() {
        return new Wall();
      }

      makeRoom() {
        return new Room();
      }

      makeDoor(room1, room2) {
        return new Door(room1, room2);
      }
    }

    class EnchantedMazeFactory extends MazeFactory {
      makeRoom() {
        return new EnchantedRoom();
      }

      makeDoor(room1, room2) {
        return new DoorNeedingSpell(room1, room2);
      }
    }

    class MazeGame {
      constructor(mazeFactory) {
        console.log(`creating a new MazeGame`);
        const myMaze = mazeFactory.makeMaze();
        const r1 = mazeFactory.makeRoom();
        const r2 = mazeFactory.makeRoom();
        const theDoor = mazeFactory.makeDoor(r1, r2);

        myMaze.addRoom(r1);
        myMaze.addRoom(r2);

        r1.setSide('N', mazeFactory.makeWall());
        r1.setSide('E', theDoor);
        r1.setSide('S', mazeFactory.makeWall());
        r1.setSide('W', mazeFactory.makeWall());

        r2.setSide('N', mazeFactory.makeWall());
        r2.setSide('E', mazeFactory.makeWall());
        r2.setSide('S', mazeFactory.makeWall());
        r2.setSide('W', theDoor);
        return myMaze;
      }
    }

    myMaze = new MazeGame(new MazeFactory());
    myEnchantedMaze = new MazeGame(new EnchantedMazeFactory());
  </script>
</body>

</html>